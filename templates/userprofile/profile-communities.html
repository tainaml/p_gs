{%extends 'home/layout/base.html' %}

{% load staticfiles %}
{% load social_tags %}
{% load thumbor_tags %}

{% block title %}Portal GSTI - Perfil{% endblock %}

{% block content %}
    <main class="container">
        <div class="perfil-row">
            <!-- mudar para 2.5 -->
            <div class="col-lg-3">
                {% include 'home/partials/sidebar-perfil.html' %}
            </div>
            <!-- mudar para 9.5 -->
            <div class="col-lg-9">
                <nav class="perfil-navegation">
                    {% if profile.user == request.user %}<a href="{% url 'profile:feed' %}">Feed</a>•{% endif %}
                    <a href="{% url 'profile:show' username=profile.user.username %}">Perfil</a>•<a href="{% url 'ninico:about' %}">Sobre</a>•<a class="active" href="{% url 'profile:communities' username=profile.user.username %}">Comunidades</a>•<a href="{% url 'profile:followers' username=profile.user.username %}">Relacionamentos</a>•<a href="{% url 'ninico:videos' %}">Vídeos</a>
                </nav>
                <header class="area-title">
                    <h2>Comunidades</h2>
                </header>
                <div class="filter row">
                    <div class="col-lg-8">
                        <form method="GET" role="search" id="search-form">
                            {% csrf_token %}
                            <div class="form-search-input">
                                <input type="text" id="fcommunity" name="fcommunity" placeholder="{{placehold|default:"Procure pessoas, comunidades, etc."}}" />
                            </div>
                            <div class="dropdown-menu dropdown-search">
                                <div class="float-notifcations">
                                    <div class="header-float-notifications">Pessoas</div>
                                    <ul class="content-float-notifications">
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification-separator">
                                        </li>
                                    </ul>
                                    <div class="header-float-notifications">Comunidades</div>
                                    <ul class="content-float-notifications">
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification-separator">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <button type="submit" id="search" class="form-search-button">
                                <i class="gsticon gsticon-search"></i>
                            </button>
                        </form>
                    </div>
                    <div class="col-lg-4 text-right">
                        <div class="custom-select">
                            <select id="cfilter">
                                <option class="custom-select-option" value="0">Selecione</option>
                            {% for category in categories %}
                                <option class="custom-select-option" value="{{ category.id }}">{{ category.description }}</option>
                            {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <hr>
                    </div>
                    <div class="col-lg-12">
                        <div class="row j-scroll-communities j-scroll-communities-container">
                            {# templatetag - load communities #}
                            {% if items %}
                                {% for community in items %}
                                    <div class="box-perfil">
                                        <div class="perfil">
                                            <img class="img-responsive" src="{% thumbor_url community.content_object.get_picture.url width=82 height=82 smart=False fit_in=False %}" alt="{{ community.content_object.title }}">
                                            <a class="perfil-name" href="{% url 'community:show' community.content_object.slug %}">{{ community.content_object.title }}</a>
                                            <a class="perfil-counter" href="{% url 'community:followers' community_slug=community.content_object.slug %}"><span class="counter-number">{% followers_count community.content_object %}</span> Seguidores</a>
                                            {% follow_action community.content_object url_next %}
                                        </div>
                                    </div>
                                {% endfor %}
                                <a data-jscroll-next href="{% url 'socialactions:get_followings' content_type_id=content_type.id object_filter_id=object.id %}?p={{ page }}&next={{ url_next|urlencode }}">next</a>
                            {% endif %}
                        </div>
                    </div>
                    <!--
                    <div class="box-perfil">
                        <div class="perfil">
                            <img class="img-responsive" src="http://placehold.it/82" alt="Imagem 1">
                            <a class="perfil-name" href="javascript:;">Python</a>
                            <a class="perfil-counter" href="javascript;;"><span class="counter-number">180</span> Seguidores</a>
                            <a class="btn btn-sm perfil-button-alt" href="javascript:;">Entrou</a>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </div>
    </main>
{% endblock %}


{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/jquery.jscroll/2.2.4/jquery.jscroll.min.js"></script>
    <script>

        $(function() {

            function filter_communities(element)
            {
                var $that = $(element);

                var $input = $('#fcommunity').val();
                console.log($('#fcommunity'));
                var $category = $("#cfilter option:selected").val();

                if ($input.length > 2){

                    $.ajax({
                        url: "{% url 'profile:communities' profile.user.username %}",
                        method: "GET",
                        dataType: "html",
                        data: {
                            'criteria': $input,
                            'category':$category,
                            csrfmiddlewaretoken: $("input:hidden[name='csrfmiddlewaretoken']").val(),
                        },
                        success: function(response) {
                            $(".j-scroll-communities-container").html(response);
                            alert(response);
                        }
                    });


                    console.log($that.data('url'));
                }
            }

            $(document).on('keyup', "#fcommunity" , function(event){
                event.preventDefault();
                filter_communities(event.currentTarget);
            });

            $(document).on('change', "#cfilter" , function(event){
                event.preventDefault();
                filter_communities(event.currentTarget);
            });

            $(document).on('submit', "#search-form" , function(event){
                event.preventDefault();
                filter_communities(event.currentTarget);

            });

            $(".j-scroll-communities").jscroll({
                contentSelect: ".j-scroll-communities-container",
                nextSelect: "a[data-jscroll-next]"
            });


        });


    </script>
{% endblock %}