{% if request.user and request.user.profile and request.user.profile.wizard_step < 3 %}
    {% include 'home/partials/first-steps/personal-infos.html' %}
    {% include 'home/partials/first-steps/categories.html' %}
    {% include 'home/partials/first-steps/sugestions.html' %}
{% endif %}
<script type="text/javascript">
    var jScrollWizard = null;

    var functionAjaxSuccessStepOne = function(e, data) {
        var $this = $(this),
                $currentModal = $this.closest(".modal.fade");

        $currentModal.modal("hide");
        $($currentModal.data("next-modal")).modal("show");
    };

    var functionAjaxSuccessStepTwo = function(e, data) {
        var $this = $(this),
                $currentModal = $this.closest(".modal.fade");

        var $wizardCommunities = $("#wizard-container-communities");
        var $wizardJScroll = $('<div />',{
            'class': 'j-scroll-wizard-communities j-scroll-wizard-communities-container'
        });

        $wizardJScroll.html(data.template);
        $wizardCommunities.html($wizardJScroll);

        var $taxonomiesSerch = $("#filter-taxonomies-wizard");
        $taxonomiesSerch.html("");
        $.each(data.taxonomies, function(i, value){
           $("<input />", {
              value: value,
              type: 'hidden',
              name: 'taxonomies'
            }).appendTo($taxonomiesSerch);
        });

        refreshAsyncLike();

        jScrollWizard = $wizardJScroll.jscroll({
            autoTrigger: false,
            loadingHtml: '<div class="load-async-preload"></div>',
            contentSelect: '.j-scroll-wizard-communities-container',
            nextSelector: "a[data-jscroll-next]",
            refresh: true,
            callback: function() {
                refreshAsyncLike();
            }
        });

        $currentModal.modal("hide");
        $($currentModal.data("next-modal")).modal("show");
    };

    var functionAjaxSuccessStepThree = function(e, data) {
        location.reload();
    };
    var functionSubmitCommunitiesSearch = function(){
            var $form = $(this).closest("form");
            $form.submit();

    };
    var functionSearchCommunities = function(e, data){

      var $containerCommunities = $("#wizard-container-communities");
{#      $containerCommunities.html(data.template);#}

        var $wizardJScroll = $('<div />',{
            'class': 'j-scroll-wizard-communities j-scroll-wizard-communities-search'
        });

        $wizardJScroll.html(data.template);
        $containerCommunities.html($wizardJScroll);
        refreshAsyncLike();
        $wizardJScroll.jscroll({
            autoTrigger: false,
            loadingHtml: '<div class="load-async-preload"></div>',
            contentSelect: '.j-scroll-wizard-communities-container',
            nextSelector: "a[data-jscroll-next]",
            refresh: true,
            callback: function() {
                refreshAsyncLike();
            }
        });
    };

    var fillValues = function() {
        var $this = $(this);
        $.ajax({
            url: $this.data("url"),
            method: "POST",
            dataType: "html",
            data: {
                value_id: $this.val(),
                csrfmiddlewaretoken: $("input:hidden[name='csrfmiddlewaretoken']").val()
            },
            success: function(response) {
                $($this.data("target")).html(response);
            }
        });
    };

    $(function() {

        $.fn.inputTyping = function (timeInMillis, callback){
            var $input = $(this);
            var typingTimer;
            $input.on('keyup', function () {
              clearTimeout(typingTimer);
              typingTimer = setTimeout(doneTyping, timeInMillis);
            });

            $input.on('keydown', function () {
              clearTimeout(typingTimer);
            });


            var doneTyping = function  () {
                callback.call($input);
            };

            return this;
        };


        $("form#form-filter-communities input[name=criteria]").inputTyping(200, functionSubmitCommunitiesSearch);
        $("[data-ajax-change='true']").on("change", fillValues);
        $(document).on("ajaxform.success", "#form-filter-communities", functionSearchCommunities);
        $("#form-personal-info").on("ajaxform.success", functionAjaxSuccessStepOne);
        $("#form-filter-categories").on("ajaxform.success", functionAjaxSuccessStepTwo);
        $("#form-suggestions").on("ajaxform.success", functionAjaxSuccessStepThree);

        {% if request.user and request.user.profile and request.user.profile.wizard_step < 1 %}
            $("#modal-personal-infos").modal("show");
        {% elif request.user and request.user.profile and request.user.profile.wizard_step < 3 %}
            $("#modal-categories").modal("show");
        {% endif %}
    });
</script>