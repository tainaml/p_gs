{% if request.user and request.user.profile and request.user.profile.wizard_step < 3 %}
    {% include 'home/partials/first-steps/personal-infos.html' %}
    {% include 'home/partials/first-steps/categories.html' %}
    {% include 'home/partials/first-steps/sugestions.html' %}
{% endif %}

<script type="text/javascript">
    var jScrollWizard = null;

    var functionAjaxSuccessStepOne = function(e, data) {
        var $this = $(this),
                $currentModal = $this.closest(".modal.fade");

        $currentModal.modal("hide");
        $($currentModal.data("next-modal")).modal("show");
    };

    var functionAjaxSuccessStepTwo = function(e, data) {
        var $this = $(this),
                $currentModal = $this.closest(".modal.fade");

        var $wizardCommunities = $("#wizard-container-communities");
        var $wizardJScroll = $('<div />');
        $wizardJScroll.addClass("j-scroll-wizard-communities j-scroll-wizard-communities-container");

        $wizardJScroll.html(data.template);
        $wizardCommunities.html($wizardJScroll);

        refreshAsyncLike();

        jScrollWizard = $wizardJScroll.jscroll({
            autoTrigger: false,
            loadingHtml: '<div class="load-async-preload"></div>',
            contentSelect: '.j-scroll-wizard-communities-container',
            nextSelector: "a[data-jscroll-next]",
            refresh: true,
            callback: function() {
                refreshAsyncLike();
            }
        });

        $currentModal.modal("hide");
        $($currentModal.data("next-modal")).modal("show");
    };

    var functionAjaxSuccessStepThree = function(e, data) {
        location.reload();
    };

    var fillValues = function() {
        var $this = $(this);
        $.ajax({
            url: $this.data("url"),
            method: "POST",
            dataType: "html",
            data: {
                value_id: $this.val(),
                csrfmiddlewaretoken: $("input:hidden[name='csrfmiddlewaretoken']").val()
            },
            success: function(response) {
                $($this.data("target")).html(response);
            }
        });
    };

    $(function() {
        $("[data-ajax-change='true']").on("change", fillValues);

        $("#form-personal-info").on("ajaxform.success", functionAjaxSuccessStepOne);
        $("#form-filter-categories").on("ajaxform.success", functionAjaxSuccessStepTwo);
        $("#form-suggestions").on("ajaxform.success", functionAjaxSuccessStepThree);

        {% if request.user and request.user.profile and request.user.profile.wizard_step < 1 %}
            $("#modal-personal-infos").modal("show");
        {% elif request.user and request.user.profile and request.user.profile.wizard_step < 3 %}
            $("#modal-categories").modal("show");
        {% endif %}
    });
</script>