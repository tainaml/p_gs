{%extends 'home/layout/base.html' %}

{% load staticfiles %}
{% load social_tags %}

{% block title %}Portal GSTI - Comunidade{% endblock %}

{% block content %}
    <main class="container main">
        <div class="perfil-row">
            <!-- mudar para 2.5 -->
            <div class="col-lg-3">
                {% include 'community/partials/community-sidebar-left.html' %}
            </div>
            <!-- mudar para 9.5 -->
            <div class="col-lg-9">
                <nav class="perfil-navegation">
                    <a href="{% url 'community:show' community.slug %}">Feed</a>•<a href="{% url 'community:questions' community.slug %}">Perguntas</a>•<a class="active" href="{% url 'community:followers' community.slug %}">Membros</a>•<a href="{% url 'community:about' community.slug %}">Sobre</a>•<a href="{% url 'community:videos' community.slug %}">Vídeos</a>
                </nav>
                <header class="area-title">
                    <h2>Membros</h2>
                </header>
                <div class="filter row">
                    <form id="filterMember" name="filterMember" action="{% url 'ninico:pesquisa' %}" method="GET" role="search" data-ajaxform="true" data-group-class=".form-group">
                    <div class="col-lg-7">

                            <div class="form-search-input">
                                <input type="text" id="filterName" name="filterName" placeholder="{{placehold|default:"Procure por alguém."}}"/>
                            </div>
                            <div class="dropdown-menu dropdown-search">
                                <div class="float-notifcations">
                                    <div class="header-float-notifications">Pessoas</div>
                                    <ul class="content-float-notifications">
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification-separator">
                                        </li>
                                    </ul>
                                    <div class="header-float-notifications">Comunidades</div>
                                    <ul class="content-float-notifications">
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification">
                                            <a href="javascript:;"><img src="http://placehold.it/20" alt="Creator Post Avatar"></a>
                                            <a href="javascript:;">Iury Silva</a>
                                        </li>
                                        <li class="item-float-notification-separator">
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <button id="filterNameButton" name="filterNameButton" type="submit" class="form-search-button">
                                <i class="gsticon gsticon-search"></i>
                            </button>

                    </div>
                    <div class="col-lg-2 col-xs-12 text-right">
                        <div class="custom-select">
                        <select class="form-control" id="filterState" name="filterState">
                            <option>BA</option>
                            <option>SP</option>
                            <option>RJ</option>
                        </select>
                        </div>
                    </div>
                    <div class="col-lg-3 col-xs-12 text-right">
                        <div class="custom-select">
                            <select class="form-control" id="filterCity" name="filterCity">
                                <option>Salvador</option>
                                <option>Da Limeira</option>
                                <option>Feira de santana</option>
                            </select>
                        </div>
                    </div>
                    </form>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <hr>
                    </div>
                    <div class="col-lg-12">
                        <div class="row j-scroll-followers j-scroll-followers-container">
                            {# templatetag - load followers #}
                            {% followers_box community request.path %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}


{% block javascripts %}

    <script>
        var jScrollElemment = null;
        var functionAjaxSuccessFilterMembers = function(e, data) {
            console.log(data);

            var $divCommunities = $("#communities-container");
            var $divJScroll = $('<div class="row j-scroll-communities j-scroll-communities-container"></div>');

            $divJScroll.html(data.template);
            $divCommunities.html($divJScroll);

            jScrollElemment = $divJScroll.jscroll({
                autoTrigger: true,
                loadingHtml: '<span>Carregando...</span>',
                contentSelect: '.j-scroll-communities-container',
                nextSelect: "a[data-jscroll-next]",
                refresh: true
            });
        };

        $(function() {
            $(document).on('keyup', "#filterName" , function(event) {
                var $this = $(event.currentTarget);

                if ($this.val().length <= 2)
                    return false;

                if ($this.val().length > 2)
                    $this.closest('form').submit();
            });

            $(document).on('change', "#filterState" , function(event) {
                // TODO Filter city

                var $this = $(event.currentTarget);
                    $this.closest('form').submit();
            });

            $(document).on('change', "#filterCity" , function(event) {
                var $this = $(event.currentTarget);
                    $this.closest('form').submit();
            });

            $("#filterMember").on("ajaxform.success", functionAjaxSuccessFilterMembers);

            $(".j-scroll-communities").jscroll({
                contentSelect: ".j-scroll-communities-container",
                nextSelect: "a[data-jscroll-next]"
            });

        });


    </script>
{% endblock %}