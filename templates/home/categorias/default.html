{% extends 'home/layout/base.html'%}
{% load social_tags %}
{% load home_blocks %}
{% load article_blocks %}
{% load home_cache %}
{% load category_tags %}
{% load cache %}
{% load thumbor_tags %}
{% load bighomecache %}

{% block title %}{{ category.description }} - Portal GSTI{% endblock %}

{% with class_name=class_name|default_if_none:"default" %}

    {% block content %}

        <main class="container main home">


                {#            {% ideiahomecache None 'home_page_cache' category_slug %}#}
                <div class="row">
                    <div class="post-list--large post-list--{{ class_name }}">
                        <div class="post-list-header">
                            <h2 class="post-list-heading">{{ category.description }}</h2>
                        </div>
                    </div>
                </div>
                {% bighomecache category_slug %}
                <div class="highlight-area-category">
                    <div class="highlight-left">
                        <div class="banner">
                            <img class="img-responsive" src="http://placehold.it/728x90" alt="Banner Example">
                        </div>
                        <div class="post-list-container">
                            {#                            {% home_block_article_home category_slug class_name=class_name quantity=4 offset=0 %}#}
                            {% article_block 'large' category_slug class_name=class_name quantity=4 offset=0 %}
                        </div>

                        {#                        {% home_block_highlight_simple category_slug class_name=class_name quantity=2 offset=4 %}#}
                        {% article_block 'simple' category_slug class_name=class_name quantity=2 differ="primeira" %}

                    </div>
                    {#                {% endcache %}#}
                    {% with community=category.community_related %}
                        <div class="highlight-right">
                            {% include "userprofile/partials/profile-community-segment.html" with community_obj=community %}
                            {#                        {% cache 0 'home_page_cache' %}#}
                            {#                            {% home_block_highlight_simple category_slug class_name=class_name quantity=2 offset=6 %}#}
                            {% article_block 'simple' category_slug class_name=class_name quantity=2 differ="lateral-1" %}

                            {#                            {% home_block_highlight_simple category_slug class_name=class_name quantity=2 offset=8 %}#}
                            {#                            {% home_block_highlight_with_image category_slug class_name=class_name quantity=2 offset=10 %}#}

                            {% article_block 'simple' category_slug class_name=class_name quantity=2 differ="lateral-2" %}
                            {% article_block 'simple-image' category_slug class_name=class_name quantity=2 offset=10 %}

                            {#                        {% endcache %}#}
                        </div>
                    {% endwith %}
                </div>

                <div class="container-posts">
                    <div class="banner-content-wide">
                        <div class="banner">
                            <img class="img-responsive" src="http://placehold.it/970x90" alt="Banner Example">
                        </div>
                    </div>


                    <section class="post-list--third post-list--{{ class_name }}">
                        <div class="post-list-header">
                            <h2 class="post-list-heading">Ãšltimas</h2>
                        </div>

                        <div class="post-list-container">
                            <div class="col-lg-12 j-scroll-communities j-scroll-communities-container">

                                <a data-jscroll-next href="{% url 'category:list-community_articles' %}?category_id={{  category.id }}&page=1"></a>
                            </div>
                        </div>
                    </section>

                    <section class="post-list--small">
                        <div class="post-list-header">
                            <h2 class="post-list-heading">Comunidades</h2>
                        </div>

                        <!-- communities_related -->
                        {% cache 3600 'category_communities_related' category_slug %}
                            {% communities_related category %}
                        {% endcache %}

                        <div class="post-list-header">
                            <h2 class="post-list-heading">Conecte-se</h2>
                        </div>
                        <div class="fb-page" data-href="https://www.facebook.com/PortalGSTIpage" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="false" data-show-posts="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/PortalGSTIpage"><a href="https://www.facebook.com/PortalGSTIpage">FB Portal GSTI</a></blockquote></div></div>
                        <!-- Place this tag where you want the widget to render. -->
                        <div id="google-badge">
                            <div class="g-page" data-width="270" data-href="https://plus.google.com/113333419239001929124" data-layout="landscape" data-rel="publisher"></div>
                        </div>
                    </section>
                </div>

            {% endbighomecache %}

        </main>

    {% endblock %}

    {% block javascripts %}
        <div id="fb-root"></div>
        <!-- Place this tag after the last widget tag. -->
        <script type="text/javascript">
            $(function() {
                document.getElementsByClassName('g-page')[0].setAttribute('data-width', document.getElementById('google-badge').clientWidth);
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/platform.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);

                $(".j-scroll-communities").jscroll({
                    contentSelect: ".j-scroll-communities-container",
                    loadingHtml: '<div class="load-async-preload"></div>',
                    nextSelector: "a[data-jscroll-next]",
                    callback: function (data) {
                        refreshAsyncLike();
                    }
                });
                var $social_count = $("[data-social-count=\"true\"]");
                $.each($social_count, function(key, value){
                    var $obj = $(value);
                    $.get($obj.data("url"), function(data){
                        $obj.text(data.count);
                    });
                });
            });

            (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id; js.async = true;
                js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.4&appId=625566967570537";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));</script>
    {% endblock %}
{% endwith %}
