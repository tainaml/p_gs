version: '2'2016-10-10
services:
  nginx:
    image: nginx
    domainname: static.redegsti.dev
    hostname: nginx
    ports:
      - "8008:80"
    volumes:
      - ./provision/data/nginx.local:/etc/nginx/conf.d/default.conf
#      - ./:/etc/nginx/html:ro
      - ./staticfiles:/etc/nginx/html/static:ro
      - ./media:/etc/nginx/html/media:ro
  thumbor:
    image: zanui/thumbor
    environment:
      AUTO_WEBP: "False"
      USE_GIFSICLE_ENGINE: "True"
      MAX_AGE: 5000
      MAX_AGE_TEMP_IMAGE: 240
      MAX_SOURCE_SIZE: 500
      QUALITY: 100
      DETECTORS: "['thumbor.detectors.face_detector','thumbor.detectors.feature_detector']"
      LOADER: 'thumbor.loaders.http_loader'
      FACE_DETECTOR_CASCADE_FILE: 'haarcascade_frontalface_alt.xml'
      USE_GIFSICLE_ENGINE: "True"
      SECURITY_KEY: "MY_SECURE_KEY"
      RESULT_STORAGE_STORES_UNSAFE: "True"
      RESULT_STORAGE: "thumbor.result_storages.file_storage"
    ports:
      - "8888:9000"
    links:
      - nginx:nginx
  memcached:
    image: memcached
    ports:
      - "11211:11211"
  db:
    image: "postgres:9.3"
    environment:
      LANG: en_US.utf8
      POSTGRES_PASSWORD: vagrant
      POSTGRES_USER: vagrant
      POSTGRES_DB: vagrant
      DB_UNACCENT: 'True'
    domainname: db.redegsti.dev
    hostname: database
    ports:
      - "5432:5432"
    volumes:
      - ../postgres_database:/var/lib/postgresql
networks:
  default:
    driver: bridge
